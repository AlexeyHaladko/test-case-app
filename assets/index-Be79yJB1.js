import{r as e}from"./rolldown-runtime-DGruFWvd.js";import{A as t,C as n,D as r,E as i,F as a,L as o,M as s,N as c,O as l,P as ee,S as u,T as d,_ as f,a as p,b as m,c as te,d as ne,f as re,g as h,h as g,i as ie,j as ae,k as oe,l as se,m as ce,n as le,o as ue,p as _,r as v,s as y,t as de,u as b,v as fe,w as x,x as pe,y as me}from"./mui-6TiAU9Pq.js";import{_ as he,a as S,c as C,d as ge,f as w,g as T,h as E,i as _e,l as ve,m as ye,n as be,o as xe,p as Se,r as Ce,s as D,t as O,u as k}from"./vendor-GYEVt3nQ.js";import{a as we,i as Te,n as A,o as j,r as Ee,t as M}from"./tanstack-BMKQJfoe.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var De=he(),N=o();const P=`auth_token`,F=()=>localStorage.getItem(P),Oe=e=>localStorage.setItem(P,e),ke=()=>localStorage.removeItem(P);function Ae(){if(!F())throw E($.LOGIN)}var je=Ae,I=a();function Me({error:e}){return(0,I.jsx)(I.Fragment,{children:e?.message||`Smth went wrong`})}var L=Me;const R=(0,N.createContext)(null),z=()=>{let e=(0,N.useContext)(R);if(!e)throw Error(`useAuth must be used within an AuthProvider`);return e};function Ne(){let{user:e,logout:t}=z();return(0,I.jsxs)(_,{direction:`row`,spacing:2,alignItems:`center`,children:[e&&(0,I.jsx)(r,{variant:`body1`,children:e.username}),(0,I.jsx)(x,{variant:`outlined`,size:`small`,onClick:t,children:`Logout`})]})}var Pe=Ne;const B=(0,N.createContext)({mode:`light`,toggleColorMode:()=>{}}),Fe=()=>(0,N.useContext)(B);function Ie(){let e=c(),{toggleColorMode:t}=Fe();return(0,I.jsx)(oe,{sx:{ml:1},onClick:t,color:`inherit`,children:e.palette.mode===`dark`?(0,I.jsx)(de,{}):(0,I.jsx)(le,{})})}var V=s(ge)(({theme:e})=>({color:`inherit`,textDecoration:`none`,padding:e.spacing(1,2),borderRadius:e.shape.borderRadius,"&.active":{backgroundColor:e.palette.action.selected,fontWeight:`bold`},"&:hover":{backgroundColor:e.palette.action.hover}}));function Le(){return(0,I.jsx)(i,{position:`static`,color:`default`,elevation:1,children:(0,I.jsxs)(y,{children:[(0,I.jsxs)(d,{sx:{flexGrow:1,display:`flex`,gap:2},children:[(0,I.jsx)(V,{to:$.DASHBOARD,children:`DASHBOARD`}),(0,I.jsx)(V,{to:$.FORM,children:`FORM`})]}),(0,I.jsxs)(d,{sx:{display:`flex`,alignItems:`center`,gap:2},children:[(0,I.jsx)(Pe,{}),(0,I.jsx)(Ie,{})]})]})})}var Re=Le;function ze(){return(0,I.jsxs)(k,{FallbackComponent:L,children:[(0,I.jsx)(Re,{}),(0,I.jsx)(w,{})]})}var Be=ze;let H=function(e){return e.username=`username`,e.password=`password`,e}({});const Ve=D({[H.username]:C().min(1,`Field is required`),[H.password]:C().min(8,`Field is required`)});let U=function(e){return e.input=`input`,e.select=`select`,e.textarea=`textarea`,e.checkbox=`checkbox`,e}({});function He({form:e,name:t,label:r,type:i=`text`,formFieldType:a=U.input,children:o}){return(0,I.jsx)(e.Field,{name:t,children:e=>{let t=e.state.meta.isTouched&&e.state.meta.errors?.length?e.state.meta.errors.map(e=>e.message).join(`, `):``,s=!!t;return(0,I.jsxs)(m,{fullWidth:!0,error:s,children:[a===U.input&&(0,I.jsx)(v,{label:r,id:e.name,type:i,value:e.state.value??``,onBlur:e.handleBlur,onChange:t=>{let n=i===`number`?t.target.valueAsNumber:t.target.value;e.handleChange(n)},error:s,helperText:t||(e.state.meta.isValidating?`Validating...`:null),fullWidth:!0}),a===U.textarea&&(0,I.jsx)(v,{label:r,id:e.name,multiline:!0,minRows:5,value:e.state.value??``,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value),error:s,helperText:t,fullWidth:!0}),a===U.select&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(f,{id:`${e.name}-label`,children:r}),(0,I.jsx)(g,{labelId:`${e.name}-label`,label:r,id:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value),error:s,children:o}),s&&(0,I.jsx)(fe,{children:t})]}),a===U.checkbox&&(0,I.jsx)(me,{control:(0,I.jsx)(n,{id:e.name,checked:!!e.state.value,onBlur:e.handleBlur,onChange:t=>{let n=t.target.checked;e.handleChange(n)}}),label:r})]})}})}var W=He;function Ue(){let{login:e}=z(),t=j({defaultValues:{[H.username]:`testuser`,[H.password]:`Test1234!`},onSubmit:({value:t})=>{e(t)},validators:{onChange:Ve}});return(0,I.jsx)(d,{sx:{maxWidth:400,mx:`auto`,mt:4,p:3,border:`1px solid #ccc`,borderRadius:2},children:(0,I.jsx)(`form`,{onSubmit:async e=>{e.preventDefault(),e.stopPropagation(),await t.handleSubmit()},children:(0,I.jsxs)(_,{spacing:2,children:[(0,I.jsx)(W,{form:t,name:H.username,label:`Username`}),(0,I.jsx)(W,{form:t,name:H.password,label:`Password`,type:`password`}),(0,I.jsx)(t.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([e,t])=>(0,I.jsx)(x,{type:`submit`,variant:`contained`,fullWidth:!0,disabled:!e,loading:t,children:`Login`})})]})})})}var We=Ue;function Ge(){let{isAuthenticated:e}=z(),t=T();return(0,N.useEffect)(()=>{e&&t($.DASHBOARD)},[e,t]),(0,I.jsx)(u,{maxWidth:`sm`,children:(0,I.jsxs)(d,{sx:{marginTop:8,display:`flex`,flexDirection:`column`,alignItems:`center`},children:[(0,I.jsx)(r,{component:`h1`,variant:`h5`,gutterBottom:!0,children:`Sign in`}),(0,I.jsx)(We,{})]})})}function Ke(){return(0,I.jsx)(`div`,{className:`auth-container`,style:{display:`flex`,justifyContent:`center`,alignItems:`center`,minHeight:`100vh`},children:(0,I.jsx)(k,{FallbackComponent:L,children:(0,I.jsx)(w,{})})})}const G={email:`email`,phone:`phone`,both:`both`},qe={failed:`failed`,flowering:`flowering`,growing:`growing`,harvested:`harvested`,planned:`planned`,planted:`planted`},K=O.create({baseURL:`https://backendcase.infodecs.dev/`,headers:{Accept:`application/json, text/plain, */*`}});K.interceptors.request.use(e=>{let t=F();return t&&(e.headers.Authorization=`Bearer ${t}`),e}),K.interceptors.response.use(e=>e,e=>{throw O.isAxiosError(e)&&e.response?.status===401?(localStorage.removeItem(P),e.response.data.error||`Smth With Wrong`):O.isAxiosError(e)?e?.response?.data?.error||`Smth With Wrong`:{message:`Smth Went Wrong `}});const q=async(e,t)=>(await K.get(e,t)).data,J=async(e,t)=>(await K.post(e,t)).data,Y={userInfo:`user_info_key`,getTableData:`table_data_key`},X={login:`/api/auth/login/`,getUserInfo:`/api/auth/user/`,getTableData:`/api/table/data/`,createCrop:`/api/form/submit/`};function Je(e){let t=F();return A({queryKey:[Y.getTableData,e],queryFn:()=>q(X.getTableData,{params:e}),staleTime:0,retry:!1,enabled:!!t})}var Ye=Je,Xe=[{field:`id`,headerName:`ID`,sortable:!0},{field:`crop_name`,headerName:`Crop`,sortable:!0},{field:`variety`,headerName:`Variety`,sortable:!0},{field:`region`,headerName:`Region`,sortable:!0},{field:`country`,headerName:`Country`,sortable:!0},{field:`status`,headerName:`Status`,sortable:!0},{field:`planting_date`,headerName:`Planting Date`,sortable:!0},{field:`yield_amount`,headerName:`Yield (kg/ha)`,sortable:!0}];function Ze(){let[e,n]=(0,N.useState)({page:1,page_size:10}),{data:i}=Ye(e),a=(e,t)=>{n(e=>({...e,page:t+1}))},o=e=>{n(t=>({...t,page_size:parseInt(e.target.value,10),page:1}))},s=t=>{e.ordering===t?n(e=>({...e,ordering:`_${t}`})):n(e=>({...e,ordering:t}))},c=e=>t=>{n(n=>({...n,[e]:t.target.value,page:1}))};return(0,I.jsx)(d,{sx:{width:`100%`},children:(0,I.jsxs)(t,{sx:{width:`100%`,mb:2,p:2},children:[(0,I.jsxs)(_,{direction:`row`,spacing:2,sx:{mb:2},children:[(0,I.jsx)(v,{label:`Filter by Crop`,variant:`outlined`,size:`small`,value:e.crop_name||``,onChange:c(`crop_name`)}),(0,I.jsx)(v,{label:`Filter by Country`,variant:`outlined`,size:`small`,value:e.country||``,onChange:c(`country`)}),(0,I.jsxs)(m,{size:`small`,sx:{minWidth:150},children:[(0,I.jsx)(f,{children:`Status`}),(0,I.jsxs)(g,{value:e.status||``,label:`Status`,onChange:e=>{n(t=>({...t,status:e.target.value,page:1}))},children:[(0,I.jsx)(h,{value:``,children:(0,I.jsx)(`em`,{children:`None`})}),Object.values(qe).map(e=>(0,I.jsx)(h,{value:e,children:e},e))]})]})]}),(0,I.jsx)(y,{sx:{pl:{sm:2},pr:{xs:1,sm:1}},children:(0,I.jsx)(r,{sx:{flex:`1 1 100%`},variant:`h6`,id:`tableTitle`,component:`div`,children:`Table`})}),(0,I.jsx)(se,{children:(0,I.jsxs)(re,{children:[(0,I.jsx)(te,{children:(0,I.jsx)(p,{children:Xe.map(t=>(0,I.jsx)(b,{children:(0,I.jsx)(ie,{active:e.ordering?.includes(t.field),direction:e.ordering===t.field?`asc`:`desc`,onClick:()=>s(t.field),children:t.headerName})},t.field))})}),(0,I.jsx)(ne,{children:i?.results.map(e=>(0,I.jsxs)(p,{children:[(0,I.jsx)(b,{children:e.id}),(0,I.jsx)(b,{children:e.crop_name}),(0,I.jsx)(b,{children:e.variety}),(0,I.jsx)(b,{children:e.region}),(0,I.jsx)(b,{children:e.country}),(0,I.jsx)(b,{children:e.status}),(0,I.jsx)(b,{children:e.planting_date}),(0,I.jsx)(b,{children:e.yield_amount})]},e.id))})]})}),(0,I.jsx)(ue,{rowsPerPageOptions:[10,25,50,100],component:`div`,count:i?.count??0,rowsPerPage:e.page_size??10,page:(e.page??1)-1,onPageChange:a,onRowsPerPageChange:o})]})})}var Qe=Ze;function $e(){return(0,I.jsx)(u,{maxWidth:`xl`,sx:{py:4},children:(0,I.jsx)(Qe,{})})}var et=async e=>await J(X.createCrop,e);function tt(e={}){return M({mutationFn:et,...e})}var nt=tt;let Z=function(e){return e.contact_method=`contact_method`,e.full_name=`full_name`,e.phone=`phone`,e.password=`password`,e.age=`age`,e.bio=`bio`,e.email=`email`,e.agree_terms=`agree_terms`,e.country=`country`,e.website=`website`,e}({});const rt=D({[Z.contact_method]:be(G),[Z.full_name]:C().min(3,`Name must be at least 3 characters`),[Z.password]:C().min(8,`Password should be at least 8 characters long`).regex(/[a-z]/,`Should contain at least one lowercase letter`).regex(/[A-Z]/,`Should contain at least one uppercase letter`).regex(/[0-9]/,`Should contain at least one digit`),[Z.age]:xe().int().min(1).max(150).optional(),[Z.phone]:C().optional().or(S(``)).refine(e=>!e||/^([+]?[\s0-9]+)?(\d{3}|[(]?[0-9]+[)])?([-]?[\s]?[0-9])+$/.test(e),{message:`Invalid phone number format`}),[Z.country]:C().optional(),[Z.website]:ve().optional().or(S(``)),[Z.bio]:C().max(500).optional(),[Z.email]:_e(`Should be a valid email`),[Z.agree_terms]:Ce().refine(e=>e,{message:`You must agree to terms and conditions`})}).superRefine((e,t)=>{(e[Z.contact_method]===G.phone||e[Z.contact_method]===G.both)&&!e[Z.phone]&&t.addIssue({code:`custom`,message:`Phone is required`,path:[Z.phone]})});var Q=(0,N.createContext)(void 0);const it=({children:e})=>{let[t,n]=(0,N.useState)(!1),[r,i]=(0,N.useState)(``),[a,o]=(0,N.useState)(`success`),s=(0,N.useCallback)((e,t=`success`)=>{i(e),o(t),n(!0)},[]),c=(e,t)=>{t!==`clickaway`&&n(!1)};return(0,I.jsxs)(Q.Provider,{value:{showSnackbar:s},children:[e,(0,I.jsx)(ce,{open:t,autoHideDuration:6e3,onClose:c,anchorOrigin:{vertical:`top`,horizontal:`right`},children:(0,I.jsx)(l,{onClose:c,severity:a,sx:{width:`100%`},children:r})})]})},at=()=>{let e=(0,N.useContext)(Q);if(!e)throw Error(`useSnackbar must be used within a SnackbarProvider`);return e};var ot={[Z.full_name]:``,[Z.password]:``,[Z.phone]:``,[Z.age]:void 0,[Z.website]:``,[Z.country]:``,[Z.bio]:``,[Z.email]:``,[Z.contact_method]:G.email,[Z.agree_terms]:!1};function st(){let{showSnackbar:e}=at(),t=j({defaultValues:ot,validators:{onChange:rt},onSubmit:({value:e})=>{n(e)}}),{mutate:n}=nt({onSuccess:()=>{t.reset(ot),e(`Form submitted successfully!`,`success`)},onError:t=>{e(t.message||`An error occurred`,`error`)}});return(0,N.useEffect)(()=>{e(`test`,`success`)},[]),(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(`form`,{style:{display:`flex`,flexDirection:`column`,width:`100%`,alignItems:`center`},onSubmit:async e=>{e.preventDefault(),e.stopPropagation(),await t.handleSubmit()},children:(0,I.jsxs)(_,{spacing:2,sx:{width:`100%`,maxWidth:800},children:[(0,I.jsx)(W,{form:t,name:Z.full_name,label:`Full Name`}),(0,I.jsx)(W,{form:t,name:Z.email,label:`Email`,type:`email`}),(0,I.jsx)(W,{form:t,name:Z.phone,label:`Phone`}),(0,I.jsx)(W,{form:t,name:Z.website,label:`Website`,type:`url`}),(0,I.jsx)(W,{form:t,name:Z.password,label:`Password`,type:`password`}),(0,I.jsx)(W,{form:t,name:Z.age,label:`Age`,type:`number`}),(0,I.jsx)(W,{form:t,name:Z.country,label:`Country`}),(0,I.jsx)(W,{form:t,name:Z.bio,label:`Bio`,formFieldType:U.textarea}),(0,I.jsx)(W,{form:t,name:Z.contact_method,label:`Contact Method`,formFieldType:U.select,children:Object.values(G).map(e=>(0,I.jsx)(h,{value:e,children:e},e))}),(0,I.jsx)(W,{form:t,name:Z.agree_terms,label:`Agree Terms`,formFieldType:U.checkbox}),(0,I.jsx)(t.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([e,t])=>(0,I.jsx)(x,{type:`submit`,variant:`contained`,disabled:!e,loading:t,children:`Submit Form`})})]})})})}var ct=st;function lt(){return(0,I.jsx)(u,{maxWidth:`xl`,sx:{p:1},children:(0,I.jsx)(d,{sx:{display:`flex`,flexDirection:`column`,alignItems:`center`},children:(0,I.jsx)(ct,{})})})}function ut(){let e=F();return A({queryKey:[Y.userInfo],queryFn:()=>q(X.getUserInfo),staleTime:1/0,retry:!1,enabled:!!e})}var dt=ut,ft=async e=>await J(X.login,e);function pt(e={}){return M({mutationFn:ft,...e})}var mt=pt;const ht=({children:e})=>{let t=Te(),{showSnackbar:n}=at(),r=T(),i=F(),{data:a,isLoading:o}=dt(),{mutate:s,isPending:c}=mt({onSuccess:e=>{t.setQueryData([Y.userInfo],e.user),Oe(e.access)},onError:e=>{n(e,`error`)}}),l={login:s,user:a,logout:()=>{ke(),t.setQueryData([Y.userInfo],null),r($.LOGIN)},isAuthenticated:!!a&&!!i,userDataLoading:o,loginProcessing:c};return(0,I.jsx)(R.Provider,{value:l,children:e})},gt=new we,_t=e=>ee({palette:{mode:e,...e===`light`?{primary:{light:`#757ce8`,main:`#3f50b5`,dark:`#002884`,contrastText:`#fff`},secondary:{light:`#ff7961`,main:`#f44336`,dark:`#ba000d`,contrastText:`#000`}}:{primary:{main:`#90caf9`},secondary:{main:`#f48fb1`}}},components:{MuiPaper:{styleOverrides:{root:{boxShadow:e===`light`?`0px 2px 8px rgba(103, 58, 183, 0.3)`:`0px 2px 8px rgba(0, 0, 0, 0.5)`}}}}});function vt(){let[e,t]=(0,N.useState)(`light`),n=(0,N.useMemo)(()=>({mode:e,toggleColorMode:()=>{t(e=>e===`light`?`dark`:`light`)}}),[e]),r=(0,N.useMemo)(()=>_t(e),[e]);return(0,I.jsx)(Ee,{client:gt,children:(0,I.jsx)(B.Provider,{value:n,children:(0,I.jsxs)(ae,{theme:r,children:[(0,I.jsx)(pe,{}),(0,I.jsx)(it,{children:(0,I.jsx)(ht,{children:(0,I.jsx)(w,{})})})]})})})}var yt=vt;const $={LOGIN:`/login`,DASHBOARD:`/dashboard`,FORM:`/form`};var bt=ye([{path:`/`,Component:yt,children:[{Component:Ke,children:[{path:$.LOGIN,Component:Ge}]},{Component:Be,middleware:[je],children:[{index:!0,loader:()=>E($.DASHBOARD)},{path:$.DASHBOARD,Component:$e},{path:$.FORM,Component:lt}]}]}]);(0,De.createRoot)(document.getElementById(`root`)).render((0,I.jsx)(N.StrictMode,{children:(0,I.jsx)(Se,{router:bt})}));